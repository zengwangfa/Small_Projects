C51 COMPILER V9.53.0.0   LCD                                                               03/18/2018 15:34:18 PAGE 1   


C51 COMPILER V9.53.0.0, COMPILATION OF MODULE LCD
OBJECT MODULE PLACED IN lcd.OBJ
COMPILER INVOKED BY: Z:\Software\Keil4\C51\BIN\C51.EXE lcd.c LARGE OPTIMIZE(8,SPEED) BROWSE DEBUG OBJECTEXTEND TABS(2)

line level    source

   1          /*********************************************************************************************************
             -*
   2          
   3                        Òº¾§ÑÝÊ¾³ÌÐòJLX12864G-330-PN-S£¬´®ÐÐ½Ó¿Ú£¡  
   4                                  Çý¶¯ICÊÇ:ST7567  
   5          **********************************************************************************************************
             -*/  
   6          #include "c8051f020.h"
   7          #include "lcd.h"
   8          #include "delay.h"
   9          #include "keydown.h"
  10          
  11          typedef unsigned int u16;
  12          typedef unsigned char u8;
  13          
  14          extern int Clock[];
  15          extern int Set_Begin[],Set_End[];
  16          int Time_Count[16]={0};
  17          u8 Time_Count_flag=0,Judge_flag=0;
  18          sbit Motor_IN = P1^7;
  19          
  20          
  21          char code maohao[]={
  22              0x00,0x00,0x00,0x30,0x30,0x00,0x00,0x00,
  23              0x00,0x00,0x00,0x18,0x18,0x00,0x00,0x00};
  24          //--  ·ûºÅ-
  25          char code heng[]={
  26              0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x80,
  27              0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00};
  28          
  29          char code xing[]={
  30              0x00,0x00,0x00,0xBE,0x2A,0x2A,0x2A,0xEA,0x2A,0x2A,0x2A,0x3E,0x00,0x00,0x00,0x00,
  31              0x00,0x44,0x42,0x49,0x49,0x49,0x49,0x7F,0x49,0x49,0x49,0x49,0x41,0x40,0x00,0x00};/*ÐÇ*/
  32          
  33          char code qi[]={
  34              0x00,0x04,0xFF,0x24,0x24,0x24,0xFF,0x04,0x00,0xFE,0x22,0x22,0x22,0xFE,0x00,0x00,
  35              0x88,0x48,0x2F,0x09,0x09,0x19,0xAF,0x48,0x30,0x0F,0x02,0x42,0x82,0x7F,0x00,0x00};/*ÆÚ*/
  36          char code rain[]={
  37              0x00,0x00,0x80,0xC0,0xE0,0xF0,0xFC,0xFF,0xFC,0xF0,0xE0,0xC0,0x80,0x00,0x00,0x00,
  38              0x00,0x0F,0x1F,0x3F,0x7F,0x7F,0xFF,0xFF,0xFF,0x7F,0x7F,0x3F,0x1F,0x0F,0x00,0x00};/*ÓêµÎ*/
  39          
  40          u8 code begin_time[]={
  41              0x40,0x40,0x42,0xCC,0x00,0x40,0xA0,0x9E,0x82,0x82,0x82,0x9E,0xA0,0x20,0x20,0x00,
  42              0x00,0x00,0x00,0x3F,0x90,0x88,0x40,0x43,0x2C,0x10,0x28,0x46,0x41,0x80,0x80,0x00,
  43              0x00,0x17,0x15,0xD5,0x55,0x57,0x55,0x7D,0x55,0x57,0x55,0xD5,0x15,0x17,0x00,0x00,
  44              0x40,0x40,0x40,0x7F,0x55,0x55,0x55,0x55,0x55,0x55,0x55,0x7F,0x40,0x40,0x40,0x00,
  45              0x10,0x60,0x02,0x0C,0xC0,0x00,0x88,0x88,0x4F,0x58,0x24,0x54,0x84,0xE4,0x00,0x00,
  46              0x04,0x04,0x7C,0x03,0x00,0x82,0x42,0x32,0x0E,0x02,0x02,0x3E,0x42,0x42,0x72,0x00,
  47              0x00,0x20,0x20,0x20,0xA0,0x60,0x00,0xFF,0x60,0x80,0x40,0x20,0x18,0x00,0x00,0x00,
  48              0x20,0x10,0x08,0x06,0x01,0x40,0x80,0x7F,0x00,0x01,0x02,0x04,0x08,0x10,0x10,0x00,
  49              0x00,0xFC,0x84,0x84,0x84,0xFC,0x00,0x10,0x10,0x10,0x10,0x10,0xFF,0x10,0x10,0x00,
  50              0x00,0x3F,0x10,0x10,0x10,0x3F,0x00,0x00,0x01,0x06,0x40,0x80,0x7F,0x00,0x00,0x00,
  51              0x00,0xF8,0x01,0x06,0x00,0xF0,0x12,0x12,0x12,0xF2,0x02,0x02,0x02,0xFE,0x00,0x00,
  52              0x00,0xFF,0x00,0x00,0x00,0x1F,0x11,0x11,0x11,0x1F,0x00,0x40,0x80,0x7F,0x00,0x00};//ÉèÖÃ³õÊ¼Ê±¼ä£¨6£©
  53          
C51 COMPILER V9.53.0.0   LCD                                                               03/18/2018 15:34:18 PAGE 2   

  54          u8 code end_time[]={
  55              0x40,0x40,0x42,0xCC,0x00,0x40,0xA0,0x9E,0x82,0x82,0x82,0x9E,0xA0,0x20,0x20,0x00,
  56              0x00,0x00,0x00,0x3F,0x90,0x88,0x40,0x43,0x2C,0x10,0x28,0x46,0x41,0x80,0x80,0x00,
  57              0x00,0x17,0x15,0xD5,0x55,0x57,0x55,0x7D,0x55,0x57,0x55,0xD5,0x15,0x17,0x00,0x00,
  58              0x40,0x40,0x40,0x7F,0x55,0x55,0x55,0x55,0x55,0x55,0x55,0x7F,0x40,0x40,0x40,0x00,
  59              0x20,0x30,0xAC,0x63,0x20,0x18,0x08,0x48,0x48,0x48,0x7F,0x48,0x48,0x48,0x08,0x00,
  60              0x22,0x67,0x22,0x12,0x12,0x12,0x00,0xFE,0x42,0x42,0x42,0x42,0x42,0xFE,0x00,0x00,
  61              0x04,0x04,0xE4,0x24,0x24,0x24,0x24,0xFF,0x24,0x24,0x24,0x24,0xE4,0x04,0x04,0x00,
  62              0x40,0x40,0x27,0x22,0x12,0x0A,0x06,0xFF,0x06,0x0A,0x12,0x22,0x27,0x40,0x40,0x00,
  63              0x00,0xFC,0x84,0x84,0x84,0xFC,0x00,0x10,0x10,0x10,0x10,0x10,0xFF,0x10,0x10,0x00,
  64              0x00,0x3F,0x10,0x10,0x10,0x3F,0x00,0x00,0x01,0x06,0x40,0x80,0x7F,0x00,0x00,0x00,
  65              0x00,0xF8,0x01,0x06,0x00,0xF0,0x12,0x12,0x12,0xF2,0x02,0x02,0x02,0xFE,0x00,0x00,
  66              0x00,0xFF,0x00,0x00,0x00,0x1F,0x11,0x11,0x11,0x1F,0x00,0x40,0x80,0x7F,0x00,0x00};//ÉèÖÃ½áÊøÊ±¼ä£¨6£©
  67          
  68          u8 code water_time[]={
  69              0x00,0x00,0xE2,0x82,0x82,0x82,0x82,0x82,0x82,0x82,0x82,0xFE,0x00,0x00,0x00,0x00,
  70              0x00,0x00,0x3F,0x40,0x40,0x40,0x40,0x40,0x40,0x40,0x40,0x40,0x40,0x78,0x00,0x00,
  71              0x10,0x60,0x02,0x0C,0xC0,0x00,0x88,0x88,0x4F,0x58,0x24,0x54,0x84,0xE4,0x00,0x00,
  72              0x04,0x04,0x7C,0x03,0x00,0x82,0x42,0x32,0x0E,0x02,0x02,0x3E,0x42,0x42,0x72,0x00,
  73              0x00,0x20,0x20,0x20,0xA0,0x60,0x00,0xFF,0x60,0x80,0x40,0x20,0x18,0x00,0x00,0x00,
  74              0x20,0x10,0x08,0x06,0x01,0x40,0x80,0x7F,0x00,0x01,0x02,0x04,0x08,0x10,0x10,0x00,
  75              0x00,0xFC,0x84,0x84,0x84,0xFC,0x00,0x10,0x10,0x10,0x10,0x10,0xFF,0x10,0x10,0x00,
  76              0x00,0x3F,0x10,0x10,0x10,0x3F,0x00,0x00,0x01,0x06,0x40,0x80,0x7F,0x00,0x00,0x00,
  77              0x00,0xF8,0x01,0x06,0x00,0xF0,0x12,0x12,0x12,0xF2,0x02,0x02,0x02,0xFE,0x00,0x00,
  78              0x00,0xFF,0x00,0x00,0x00,0x1F,0x11,0x11,0x11,0x1F,0x00,0x40,0x80,0x7F,0x00,0x00,
  79              0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
  80              0x00,0x00,0x36,0x36,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00};//ÒÑ½½Ë®Ê±¼ä£º£¨6£©
  81          
  82          u8 code not_water[]={
  83              0x40,0x40,0x42,0xCC,0x00,0x00,0x02,0x82,0x42,0xF2,0x0E,0x42,0x82,0x02,0x00,0x00,
  84              0x00,0x40,0x20,0x1F,0x20,0x42,0x41,0x40,0x40,0x5F,0x40,0x40,0x40,0x43,0x40,0x00,
  85              0x80,0x80,0x88,0x88,0x88,0x88,0x88,0xFF,0x88,0x88,0x88,0x88,0x88,0x80,0x80,0x00,
  86              0x20,0x20,0x10,0x08,0x04,0x02,0x01,0xFF,0x01,0x02,0x04,0x08,0x10,0x20,0x20,0x00,
  87              0x80,0x82,0x82,0x82,0xFE,0x82,0x82,0x82,0x82,0x82,0xFE,0x82,0x82,0x82,0x80,0x00,
  88              0x00,0x80,0x40,0x30,0x0F,0x00,0x00,0x00,0x00,0x00,0xFF,0x00,0x00,0x00,0x00,0x00,
  89              0x10,0x10,0xF0,0x1F,0x10,0xF0,0x00,0x40,0xE0,0x58,0x47,0x40,0x50,0x60,0xC0,0x00,
  90              0x40,0x22,0x15,0x08,0x16,0x21,0x00,0x00,0xFE,0x42,0x42,0x42,0x42,0xFE,0x00,0x00,
  91              0x10,0x60,0x02,0x0C,0xC0,0x00,0x88,0x88,0x4F,0x58,0x24,0x54,0x84,0xE4,0x00,0x00,
  92              0x04,0x04,0x7C,0x03,0x00,0x82,0x42,0x32,0x0E,0x02,0x02,0x3E,0x42,0x42,0x72,0x00,
  93              0x00,0x20,0x20,0x20,0xA0,0x60,0x00,0xFF,0x60,0x80,0x40,0x20,0x18,0x00,0x00,0x00,
  94              0x20,0x10,0x08,0x06,0x01,0x40,0x80,0x7F,0x00,0x01,0x02,0x04,0x08,0x10,0x10,0x00,
  95              0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
  96              0x00,0x00,0x36,0x36,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00};//Î´¿ªÊ¼½½Ë®:  (6)
  97          
  98          u8 code end_water[]={
  99              0x00,0x00,0xE2,0x82,0x82,0x82,0x82,0x82,0x82,0x82,0x82,0xFE,0x00,0x00,0x00,0x00,
 100              0x00,0x00,0x3F,0x40,0x40,0x40,0x40,0x40,0x40,0x40,0x40,0x40,0x40,0x78,0x00,0x00,
 101              0x20,0x30,0xAC,0x63,0x20,0x18,0x08,0x48,0x48,0x48,0x7F,0x48,0x48,0x48,0x08,0x00,
 102              0x22,0x67,0x22,0x12,0x12,0x12,0x00,0xFE,0x42,0x42,0x42,0x42,0x42,0xFE,0x00,0x00,
 103              0x04,0x04,0xE4,0x24,0x24,0x24,0x24,0xFF,0x24,0x24,0x24,0x24,0xE4,0x04,0x04,0x00,
 104              0x40,0x40,0x27,0x22,0x12,0x0A,0x06,0xFF,0x06,0x0A,0x12,0x22,0x27,0x40,0x40,0x00,
 105              0x10,0x60,0x02,0x0C,0xC0,0x00,0x88,0x88,0x4F,0x58,0x24,0x54,0x84,0xE4,0x00,0x00,
 106              0x04,0x04,0x7C,0x03,0x00,0x82,0x42,0x32,0x0E,0x02,0x02,0x3E,0x42,0x42,0x72,0x00,
 107              0x00,0x20,0x20,0x20,0xA0,0x60,0x00,0xFF,0x60,0x80,0x40,0x20,0x18,0x00,0x00,0x00,
 108              0x20,0x10,0x08,0x06,0x01,0x40,0x80,0x7F,0x00,0x01,0x02,0x04,0x08,0x10,0x10,0x00,
 109              0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
 110            0x00,0x00,0x36,0x36,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00};//ÒÑ½áÊø½½Ë®:  (6)
 111              
 112          u8 code weekday[]={
 113              0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x00,
 114              0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
 115              0x00,0x00,0x08,0x08,0x08,0x08,0x08,0x08,0x08,0x08,0x08,0x08,0x08,0x00,0x00,0x00,
C51 COMPILER V9.53.0.0   LCD                                                               03/18/2018 15:34:18 PAGE 3   

 116              0x10,0x10,0x10,0x10,0x10,0x10,0x10,0x10,0x10,0x10,0x10,0x10,0x10,0x10,0x10,0x00,
 117              0x00,0x04,0x84,0x84,0x84,0x84,0x84,0x84,0x84,0x84,0x84,0x84,0x84,0x04,0x00,0x00,
 118              0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x00,
 119              0x00,0xFC,0x04,0x04,0x04,0xFC,0x04,0x04,0x04,0xFC,0x04,0x04,0x04,0xFC,0x00,0x00,
 120              0x00,0x7F,0x28,0x24,0x23,0x20,0x20,0x20,0x20,0x21,0x22,0x22,0x22,0x7F,0x00,0x00,
 121              0x00,0x02,0x42,0x42,0x42,0xC2,0x7E,0x42,0x42,0x42,0x42,0xC2,0x02,0x02,0x00,0x00,
 122              0x40,0x40,0x40,0x40,0x78,0x47,0x40,0x40,0x40,0x40,0x40,0x7F,0x40,0x40,0x40,0x00,
 123              0x20,0x20,0x20,0x20,0x20,0x20,0x21,0x22,0x2C,0x20,0x20,0x20,0x20,0x20,0x20,0x00,
 124              0x00,0x40,0x20,0x10,0x0C,0x03,0x00,0x00,0x00,0x01,0x02,0x04,0x18,0x60,0x00,0x00,
 125              0x40,0x40,0x42,0x42,0x42,0x42,0x42,0xFE,0x42,0x42,0x42,0x42,0x42,0x40,0x40,0x00,
 126              0x80,0x80,0x40,0x20,0x10,0x0C,0x03,0x00,0x03,0x0C,0x10,0x20,0x40,0x80,0x80,0x00};
 127            
 128          //--  ÎÄ×Ö:  0,1,2,3,4,5,6,7,8,9    ¿íx¸ß=8x16
 129          u8 code num[]={ 
 130              0x00,0xE0,0x10,0x08,0x08,0x10,0xE0,0x00,0x00,0x0F,0x10,0x20,0x20,0x10,0x0F,0x00,
 131              0x00,0x10,0x10,0xF8,0x00,0x00,0x00,0x00,0x00,0x20,0x20,0x3F,0x20,0x20,0x00,0x00,
 132              0x00,0x70,0x08,0x08,0x08,0x88,0x70,0x00,0x00,0x30,0x28,0x24,0x22,0x21,0x30,0x00,
 133              0x00,0x30,0x08,0x88,0x88,0x48,0x30,0x00,0x00,0x18,0x20,0x20,0x20,0x11,0x0E,0x00,
 134              0x00,0x00,0xC0,0x20,0x10,0xF8,0x00,0x00,0x00,0x07,0x04,0x24,0x24,0x3F,0x24,0x00,
 135              0x00,0xF8,0x08,0x88,0x88,0x08,0x08,0x00,0x00,0x19,0x21,0x20,0x20,0x11,0x0E,0x00,
 136              0x00,0xE0,0x10,0x88,0x88,0x18,0x00,0x00,0x00,0x0F,0x11,0x20,0x20,0x11,0x0E,0x00,
 137              0x00,0x38,0x08,0x08,0xC8,0x28,0x18,0x00,0x00,0x00,0x00,0x3F,0x00,0x00,0x00,0x00,
 138              0x00,0x70,0x88,0x08,0x08,0x88,0x70,0x00,0x00,0x1C,0x22,0x21,0x21,0x22,0x1C,0x00,
 139              0x00,0xE0,0x10,0x08,0x08,0x10,0xE0,0x00,0x00,0x08,0x31,0x22,0x22,0x11,0x0F,0x00};
 140          
 141          u8 code kong[]={  
 142              0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00};
 143          u8 code kong1[]={ 
 144              0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
 145              0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00};
 146          
 147          
 148          
 149          
 150          
 151          /*******************************´Ë³ÌÐò³õÊ¼»¯ÏµÍ³Ê±ÖÓÊ¹ÓÃ22.1184MHz¾§ÌåÎªÊ±ÖÓÔ´****************************
             -*/   
 152          /*void SYSCLK_Init (void)
 153          {
 154              INT8U i;
 155              OSCXCN = 0x67;              // ¿ªÆôÍâ²¿Õñµ´Æ÷22.1184MHz¾§Ìå
 156              for (i=0; i < 255; i++) ;         // µÈ´ýÕñµ´Æ÷ÆôÕñ
 157              while (!(OSCXCN & 0x80)) ;        // µÈ´ý¾§ÌåÕñµ´Æ÷ÎÈ¶¨
 158              OSCICN = 0x88;              // Ñ¡ÔñÍâ²¿Õñµ´Æ÷ÎªÏµÍ³Ê±ÖÓÔ´²¢ÔÊÐí¶ªÊ§Ê±ÖÓ¼ì²âÆ÷
 159          }     */
 160          
 161          /*************************************************LCDÄ£¿é³õÊ¼»¯*******************************************
             -*/   
 162          void Initial_Lcd()   
 163          {   
 164   1          reset=0;                    /*µÍµçÆ½¸´Î»*/   
 165   1          delay(10);   
 166   1          reset=1;                    /*¸´Î»Íê±Ï*/   
 167   1          delay(10);                               
 168   1        transfer_command(0xe2);     /*Èí¸´Î»*/   
 169   1        delay(5);   
 170   1        transfer_command(0x2c);     /*ÉýÑ¹²½¾Û1*/   
 171   1        delay(5);       
 172   1        transfer_command(0x2e);     /*ÉýÑ¹²½¾Û2*/   
 173   1        delay(5);   
 174   1        transfer_command(0x2f);     /*ÉýÑ¹²½¾Û3*/   
 175   1        delay(5);   
C51 COMPILER V9.53.0.0   LCD                                                               03/18/2018 15:34:18 PAGE 4   

 176   1        transfer_command(0x24);     /*´Öµ÷¶Ô±È¶È£¬¿ÉÉèÖÃ·¶Î§ 0x20¡«0x27*/   
 177   1        transfer_command(0x81);     /*Î¢µ÷¶Ô±È¶È*/   
 178   1        transfer_command(0x12);     /*0x1a,Î¢µ÷¶Ô±È¶ÈµÄÖµ£¬¿ÉÉèÖÃ·¶Î§ 0x00¡«0x3f*/   
 179   1        transfer_command(0xa2);     /*1/9Æ«Ñ¹±È£¨bias£©*/   
 180   1        transfer_command(0xc8);     /*ÐÐÉ¨ÃèË³Ðò£º´ÓÉÏµ½ÏÂ*/   
 181   1        transfer_command(0xa0);     /*ÁÐÉ¨ÃèË³Ðò£º´Ó×óµ½ÓÒ*/   
 182   1        transfer_command(0x40);     /*ÆðÊ¼ÐÐ£ºµÚÒ»ÐÐ¿ªÊ¼*/   
 183   1        transfer_command(0xaf);     /*¿ªÏÔÊ¾*/   
 184   1      }   
 185          
 186          
 187          
 188          /************************************************Ð´Ö¸Áîµ½LCDÄ£¿é******************************************
             -*****************/   
 189          void transfer_command(int data1)           
 190          {   
 191   1          char i;   
 192   1          cs1=0;   
 193   1          rs=0;   
 194   1          for(i=0;i<8;i++)   
 195   1          {   
 196   2              sclk=0; 
 197   2              lcddelay_us(2);   
 198   2              if(data1&0x80) sda=1;   
 199   2              else sda=0;   
 200   2              sclk=1;   
 201   2              lcddelay_us(2);   
 202   2              data1=data1<<=1;   
 203   2          }   
 204   1          cs1=1;   
 205   1      }   
 206          
 207          
 208          
 209          /**************************************************Ð´Êý¾Ýµ½LCDÄ£¿é****************************************
             -*****************/   
 210          void transfer_data(int data1)   
 211          {   
 212   1        char i;   
 213   1        cs1=0;   
 214   1        rs=1;   
 215   1        for(i=0;i<8;i++)   
 216   1        {   
 217   2          sclk=0;   
 218   2          //lcddelay_us(1);   
 219   2          if(data1&0x80) sda=1;   
 220   2          else sda=0;   
 221   2          sclk=1;   
 222   2          //lcddelay_us(1);   
 223   2          data1=data1<<=1;   
 224   2        }   
 225   1        cs1=1;   
 226   1      }  
 227          
 228           
 229          /******************************************************ÑÓÊ±***********************************************
             -***********/   
 230          void delay(int i)                                                           
 231          {   
 232   1        int j,k;   
 233   1        for(j=0;j<i;j++)   
 234   1        for(k=0;k<110;k++);   
C51 COMPILER V9.53.0.0   LCD                                                               03/18/2018 15:34:18 PAGE 5   

 235   1      }   
 236          /******************************************************ÑÓÊ±***********************************************
             -**********/   
 237          void lcddelay_us(int i)                                                           
 238          {   
 239   1        int j,k;   
 240   1        for(j=0;j<i;j++)   
 241   1          for(k=0;k<1;k++);   
 242   1      }       
 243          
 244          /*void waitkey()   
 245          {   
 246          repeat:   
 247            if(key==1) goto repeat;   
 248            else delay(1000);   
 249          } */
 250          
 251          /************************************************¶¨ÒåµØÖ·*************************************************
             -**********/     
 252          void lcd_address(uchar page,uchar column)   
 253          {   
 254   1        column=column-1;                               //ÎÒÃÇÆ½³£ËùËµµÄµÚ1ÁÐ£¬ÔÚLCDÇý¶¯ICÀïÊÇµÚ0ÁÐ¡£ËùÒÔÔÚÕâÀï¼õÈ
             -¥1. 
 255   1        page=page-1;                             /*ÉèÖÃÒ³µØÖ·¡£Ã¿Ò³ÊÇ8ÐÐ¡£Ò»¸ö»­ÃæµÄ64ÐÐ±»·Ö³É8¸öÒ³¡£ÎÒÃÇÆ½³£ËùËµµÄ
             -µÚ1Ò³£¬
 256   1                                                         ÔÚLCDÇý¶¯ICÀïÊÇµÚ0Ò³,ËùÒÔÔÚÕâÀï¼õÈ¥1*/ 
 257   1        transfer_command(0xb0+page);           
 258   1        transfer_command(((column>>4)&0x0f)+0x10);   //ÉèÖÃÁÐµØÖ·µÄ¸ß4Î»  
 259   1        transfer_command(column&0x0f);         //ÉèÖÃÁÐµØÖ·µÄµÍ4Î»  
 260   1         
 261   1      }   
 262            
 263            
 264          /************************************************È«ÆÁÇåÆÁ*************************************************
             -**********/ 
 265          void clear_screen() 
 266          {   
 267   1        unsigned char i,j;   
 268   1          for(i=0;i<9;i++)
 269   1         //for(i=0;i<2;i++)                //test lxq5.22   
 270   1        {   
 271   2          lcd_address(1+i,1);   
 272   2          for(j=0;j<132;j++)
 273   2          //  for(j=0;j<2;j++)             //test lxq5.22
 274   2          {   
 275   3                 transfer_data(0x00);   
 276   3            }   
 277   2          }   
 278   1      }
 279          
 280          
 281          /***********************Ð´ÈëµÄ³ÌÐò****************************/
 282          
 283          void display_graphic_8x16(uchar page,uchar column,uchar *dp)   //x,y(page ÎªÐÐ£¬conlumnÎªÁÐ)
 284          {   
 285   1        uchar i,j;   
 286   1        for(j=0;j<2;j++)   
 287   1        {   
 288   2          lcd_address(page+j,column);   
 289   2          for (i=0;i<8;i++)   
 290   2          {   
 291   3            transfer_data(*dp);   
C51 COMPILER V9.53.0.0   LCD                                                               03/18/2018 15:34:18 PAGE 6   

 292   3            dp++;                 /*Ð´Êý¾Ýµ½LCD,Ã¿Ð´ÍêÒ»¸ö8Î»µÄÊý¾ÝºóÁÐµØÖ·×Ô¶¯¼Ó1*/   
 293   3          }   
 294   2        }   
 295   1      }
 296          
 297          void display_graphic_16x16(uchar page,uchar column,uchar *dp)   
 298          {   
 299   1        uchar i,j;   
 300   1        for(j=0;j<2;j++)   
 301   1        {   
 302   2          lcd_address(page+j,column);   
 303   2          for (i=0;i<16;i++)   
 304   2          {   
 305   3            transfer_data(*dp);   
 306   3            dp++;                 /*Ð´Êý¾Ýµ½LCD,Ã¿Ð´ÍêÒ»¸ö8Î»µÄÊý¾ÝºóÁÐµØÖ·×Ô¶¯¼Ó1*/   
 307   3          }   
 308   2        }   
 309   1      }
 310          
 311          /*
 312          void display_graphic_32x32(uchar page,uchar column,uchar *dp)   
 313          {   
 314              uchar i,j;   
 315            for(j=0;j<4;j++)   
 316            {   
 317              lcd_address(page+j,column);   
 318              for (i=0;i<31;i++)   
 319              {   
 320              transfer_data(*dp);   
 321              dp++;   
 322                                        //Ð´Êý¾Ýµ½LCD,Ã¿Ð´ÍêÒ»¸ö8Î»µÄÊý¾ÝºóÁÐµØÖ·×Ô¶¯¼Ó1 
 323              }   
 324            }   
 325          }   */
 326          
 327          
 328          
 329          void Time_Display() //Ê±¼äÏÔÊ¾
 330          {
 331   1          display_graphic_8x16(5,(8+8*0),&num[2*16]);
 332   1          display_graphic_8x16(5,(8+8*1),&num[0*16]);
 333   1          display_graphic_8x16(5,(8+8*2),&num[Clock[8]/16*16]);
 334   1          display_graphic_8x16(5,(8+8*3),&num[Clock[8]%16*16]);//Äê
 335   1          display_graphic_8x16(5,(8+8*4),heng);
 336   1          display_graphic_8x16(5,(8+8*5),&num[(Clock[7]&0x1f)/16*16]);
 337   1          display_graphic_8x16(5,(8+8*6),&num[(Clock[7]&0x1f)%16*16]);//ÔÂ
 338   1          display_graphic_8x16(5,(8+8*7),heng);
 339   1          display_graphic_8x16(5,(8+8*8),&num[(Clock[5]&0x3f)/16*16]);
 340   1          display_graphic_8x16(5,(8+8*9),&num[(Clock[5]&0x3f)%16*16]);//ÈÕ
 341   1          display_graphic_8x16(7,(16+8*0),&num[(Clock[4]&0x3f)/16*16]);
 342   1          display_graphic_8x16(7,(16+8*1),&num[(Clock[4]&0x3f)%16*16]);//Ê±
 343   1          display_graphic_8x16(7,(16+8*2),maohao);
 344   1          display_graphic_8x16(7,(16+8*3),&num[(Clock[3]&0x7f)/16*16]);
 345   1          display_graphic_8x16(7,(16+8*4),&num[(Clock[3]&0x7f)%16*16]);//·Ö
 346   1          display_graphic_8x16(7,(16+8*5),maohao);
 347   1          display_graphic_8x16(7,(16+8*6),&num[(Clock[2]&0x7f)/16*16]);
 348   1          display_graphic_8x16(7,(16+8*7),&num[(Clock[2]&0x7f)%16*16]);//Ãë
 349   1      
 350   1          display_graphic_16x16(3,(112),xing);
 351   1          display_graphic_16x16(5,(112),qi);
 352   1          display_graphic_16x16(7,(112),&weekday[(Clock[6]&0x07)*32]);
 353   1          //zifukong();//µÚÒ»Ò³Ê±£¬µÚÒ»ÐÐÎÄ×Ö²»ÏÔÊ¾¼´Îª¿Õ
C51 COMPILER V9.53.0.0   LCD                                                               03/18/2018 15:34:18 PAGE 7   

 354   1      }
 355          int bcd_dec(uchar bat)  //BCDÂë×ªÊ®½øÖÆ
 356          {
 357   1        uchar temp1,temp2,tol;
 358   1        temp1=bat&0x0f;
 359   1        temp2=(bat&0xf0)>>4;
 360   1        tol=temp2*10+temp1;
 361   1        return tol; 
 362   1      }
 363          
 364          void Time_Watch()
 365          {
 366   1          u8 x,y,z,k;
 367   1          Time_Count[4]=((bcd_dec(Clock[4]&0x3f))-(Set_Begin[4]));//Ê± ÅÐ¶Ï¿ªÊ¼½½Ë®Ê±¼ä
 368   1          Time_Count[3]=((bcd_dec(Clock[3]&0x7f))-(Set_Begin[3]));//·Ö
 369   1          Time_Count[2]=((bcd_dec(Clock[2]&0x7f))-(Set_Begin[2]));//Ãë
 370   1          
 371   1          Time_Count[7]=((bcd_dec(Clock[4]&0x3f))-(Set_End[4]));//Ê±   ÅÐ¶Ï½áÊø½½Ë®Ê±¼ä
 372   1          Time_Count[6]=((bcd_dec(Clock[3]&0x7f))-(Set_End[3]));//·Ö
 373   1          Time_Count[5]=((bcd_dec(Clock[2]&0x7f))-(Set_End[2]));//Ãë
 374   1          if(Time_Count[3]<0){Time_Count[4]-=1;Time_Count[3]+=60;}//µ±·ÖÊý £¨SET£©>·ÖÊý£¨TIME£©Îª¸º +60ÐÞÕý,Ð¡Ê±-1
 375   1          if(Time_Count[2]<0){Time_Count[3]-=1;Time_Count[2]+=60;}//µ±ÃëÊý £¨SET£©>ÃëÊý£¨TIME£©Îª¸º +60ÐÞÕý,·ÖÖÓ-
             -1
 376   1          if(Time_Count[5]<0){Time_Count[6]-=1;Time_Count[5]+=60;}//µ±ÃëÊý £¨END£©>ÃëÊý£¨TIME£©Îª¸º +60ÐÞÕý,·ÖÖÓ-1
 377   1          if(Time_Count[6]<0){Time_Count[7]-=1;Time_Count[6]+=60;}//µ±·ÖÊý £¨END£©>ÃëÊý£¨TIME£©Îª¸º +60ÐÞÕý,Ð¡Ê±-1
 378   1          if(Judge_flag == 1)
 379   1          {
 380   2            if( (Time_Count[4]>0) ) Time_Count_flag=1;
 381   2            else if ( (Time_Count[4]==0)&&(Time_Count[3]>0) )Time_Count_flag=1;
 382   2            else if ( (Time_Count[4]==0)&&(Time_Count[3]==0)&&(Time_Count[2]>0) )Time_Count_flag=1;
 383   2            else Time_Count_flag=0;
 384   2          }
 385   1        
 386   1          if( (Time_Count[7]>=0)&&(Time_Count[6]>=0)&&(Time_Count[5]>=0)){Time_Count_flag=2;Judge_flag=0;}//½áÊø½½
             -Ë®×ÖÄ»ÏÔÊ¾Ò»Ð¡Ê±
 387   1          else Judge_flag=1;
 388   1      
 389   1          if(Time_Count_flag == 0)//Î´¿ªÊ¼½½Ë®
 390   1          {
 391   2            for(x=0;x<6;x++)
 392   2            {display_graphic_16x16(1,(8+16*x),&not_water[x*32]);}//»¹Î´¿ªÊ¼½½Ë®
 393   2            
 394   2            for(y=0;y<8;y++)
 395   2            {display_graphic_8x16(3,(16+8*y),kong);}
 396   2            Motor_IN=1;
 397   2          }
 398   1          
 399   1          if(Time_Count_flag == 1)//¿ªÊ¼½½Ë®
 400   1          {
 401   2            for(z=0;z<6;z++)
 402   2            {display_graphic_16x16(1,(8+16*z),&water_time[z*32]);}//ÒÑ½½Ë®Ê±¼ä£º
 403   2            display_graphic_8x16(3,(16+8*0),&num[(Time_Count[4]/10*16)]);
 404   2            display_graphic_8x16(3,(16+8*1),&num[(Time_Count[4]%10*16)]);//Ê±
 405   2            display_graphic_8x16(3,(16+8*2),maohao);
 406   2            display_graphic_8x16(3,(16+8*3),&num[(Time_Count[3]/10*16)]);
 407   2            display_graphic_8x16(3,(16+8*4),&num[(Time_Count[3]%10*16)]);//·Ö
 408   2            display_graphic_8x16(3,(16+8*5),maohao);
 409   2            display_graphic_8x16(3,(16+8*6),&num[(Time_Count[2]/10*16)]);
 410   2            display_graphic_8x16(3,(16+8*7),&num[(Time_Count[2]%10*16)]);//Ãë
 411   2            display_graphic_16x16(1,(0+16*7),rain);
 412   2            Delay_ms(100);
 413   2            display_graphic_16x16(1,(0+16*7),kong1);
C51 COMPILER V9.53.0.0   LCD                                                               03/18/2018 15:34:18 PAGE 8   

 414   2            Delay_ms(100);
 415   2            Motor_IN=0;
 416   2          }
 417   1          
 418   1          if(Time_Count_flag == 2)//½áÊø½½Ë®
 419   1          {
 420   2            for(k=0;k<6;k++)
 421   2            {display_graphic_16x16(1,(8+16*k),&end_water[k*32]);}//ÒÑ½áÊø½½Ë®:
 422   2            
 423   2            for(y=0;y<8;y++)
 424   2            {display_graphic_8x16(3,(16+8*y),kong);}
 425   2            Motor_IN=1;
 426   2          }
 427   1        
 428   1        
 429   1          
 430   1      }
 431          
 432          


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =   2320    ----
   CONSTANT SIZE    =   1552    ----
   XDATA SIZE       =     34      21
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
